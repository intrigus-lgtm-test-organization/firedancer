name: Benchmark Ledger Backtest
on:
  workflow_call:
    inputs:
      machine:
        type: string
        default: linux_gcc_zen2
      extras:
        type: string
        default: "handholding"
      github-token:
        type: string
        required: true
        description: 'GitHub token for posting comments'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  benchmark:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    env:
      CC: gcc
      MACHINE: ${{ inputs.machine }}
      EXTRAS: ${{ inputs.extras }}

    steps:
    - name: Generate Comment Content
      id: generate-comment
      uses: actions/github-script@v8
      with:
        script: |
          const fs = require('fs');

          // Save to file for artifact
          fs.writeFileSync('comment.txt', "## Performance Measurements ‚è≥");

          // Save PR number if this is a pull request or issue comment
          if (context.eventName === 'pull_request' || context.eventName === 'issue_comment') {
            fs.writeFileSync('pr_number.txt', context.issue.number.toString());
          }

    - name: Upload comment artifacts
      if: github.event_name == 'pull_request' || github.event_name == 'issue_comment'
      uses: actions/upload-artifact@v4
      with:
        name: benchmark-comment
        path: |
          comment.txt
          pr_number.txt
        retention-days: 5
